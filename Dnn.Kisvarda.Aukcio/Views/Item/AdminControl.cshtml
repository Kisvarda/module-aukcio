@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<IEnumerable<Kisvarda.Dnn.Dnn.Kisvarda.Aukcio.Models.Item>>

@using System
@using DotNetNuke.Web.Mvc.Helpers
@using DotNetNuke.Entities.Users
@using DotNetNuke.Framework.JavaScriptLibraries

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="../../module.css" />

<div class="admin-control">
    <h1>Admin Control Panel</h1>
    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Highest Bid</th>
                <th>Bidder ID</th>
                <th>Time Remaining</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var auction in Model)
            {
                var timeRemaining = auction.AuctionEndTime.HasValue
                    ? auction.AuctionEndTime.Value - DateTime.UtcNow
                    : TimeSpan.Zero;

                <tr>
                    <td>@auction.ItemName</td>
                    <td>$@(auction.HighestBid ?? 0)</td>
                    <td>@auction.HighestBidUserId</td>
                    <td class="time-remaining" data-time-remaining="@Math.Max(0, timeRemaining.TotalSeconds)">
                        @if (timeRemaining.TotalSeconds <= 0)
                        {
                            <span class="ended-text">Ended</span>
                        }
                        else
                        {
                            <span class="countdown">@timeRemaining.ToString(@"dd\:hh\:mm\:ss")</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const countdownElements = document.querySelectorAll(".time-remaining");

        countdownElements.forEach(function (element) {
            const totalSeconds = parseInt(element.getAttribute("data-time-remaining"), 10);
            const countdownSpan = element.querySelector(".countdown");

            if (totalSeconds > 0) {
                let remainingSeconds = totalSeconds;

                const interval = setInterval(function () {
                    if (remainingSeconds <= 0) {
                        clearInterval(interval);
                        countdownSpan.textContent = "Ended";
                        element.classList.add("ended-text");
                    } else {
                        const days = Math.floor(remainingSeconds / 86400);
                        const hours = Math.floor((remainingSeconds % 86400) / 3600);
                        const minutes = Math.floor((remainingSeconds % 3600) / 60);
                        const seconds = remainingSeconds % 60;

                        countdownSpan.textContent = `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        remainingSeconds--;
                    }
                }, 1000);
            } else {
                countdownSpan.textContent = "Ended";
                element.classList.add("ended-text");
            }
        });
    });</script>
